<!DOCTYPE html>
<html>
  <head>
    <title>Silicon Prep</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <link rel="stylesheet" type="text/css" href="style/sp.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
  <body>
    <div class="sign_up_banner">
      <span class="open_date_1"></span> thru <span class="open_date_2"></span> class at <a href="https://www.mcabayarea.org/" target="_blank">MCA</a> - registration open. <a href="index.html#enroll">Enroll now!</a>
    </div>
    <nav>
      <a href="/">Silicon Prep</a>
      <a class="selected" href="calendar.html">Calendar</a>
      <a href="course.html">Course</a>
    </nav>
    <div class="info">
      <h2>Classes</h2>
      <p>Silcon Prep classes are all held <strong>live and in-person</strong>, with livestream links for remote students where they can watch the instructor, ask questions, and receive directed help and feedback.</p>
      <p>Registering for a session includes <strong>15 classes</strong> of live teaching, with each class 2 hours long. There are also assignments and exercises supplementing each class. Class times usually held around 6pm PST but can vary for a session.</p>
    </div>
    <div class="calendars">
      <div class="legend">
        <div class="active_color"></div> <span class="legend_title">active session</span>
        <div class="open_color"></div> <span class="legend_title">open registration</span>
        <div class="today_color"></div> <span class="legend_title">today</span>
      </div>
      <div class="calendar_row">
        <button class="ui icon teal button previous_calendar">
          <i class="chevron left icon"></i>
        </button>
        <div class="calendar_set"></div>
        <button class="ui icon teal button next_calendar">
          <i class="chevron right icon"></i>
        </button>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js"></script>
    <script src="script/sp.js"></script>
    <script>
      $('.ui.dropdown').dropdown();
      function addCalendar(month, year, class_dates, prepend) {
        var today = moment();
        var start_of_month = moment().year(year).month(month).date(1);
        var start_of_cal = moment(start_of_month);
        while (start_of_cal.weekday() != 0) {
          start_of_cal.subtract(1, 'days');
        }
        var end_of_month = moment(start_of_month).add(1, 'months').subtract(1, 'days');
        var end_of_cal = moment(end_of_month);
        while (end_of_cal.weekday() != 6) {
          end_of_cal.add(1, 'days');
        }
        var html = `
          <div class="calendar">
            <div class="month">${start_of_month.format("MMMM YYYY")}</div>
            <div class="weekday_names">
              <div class="day_name">S</div><div class="day_name">M</div><div class="day_name">T</div><div class="day_name">W</div><div class="day_name">T</div><div class="day_name">F</div><div class="day_name">S</div>
            </div>
        `
        var date = moment(start_of_cal)
        for (let row_count = 0; row_count < 6; row_count++) {
          html += `<div class="weekdays">`
            for (let i = 0; i < 7; i++) {
              var is_today = date.format("YYYYMMDD") == today.format("YYYYMMDD") ? "today" : "";
              html += `<div class="day ${is_today}">`
              if (date.month() == start_of_month.month()) {
                datenum = date.date();
                html += datenum
                var formatted_date = date.format("YYYYMMDD")
                var active_index = class_dates.active.indexOf(formatted_date);
                var open_index = class_dates.open.indexOf(formatted_date);
                if (active_index >= 0) {
                  html += `<div class="day_marker active"></div>`
                } else if (open_index >= 0) {
                  html += `<div class="day_marker open"></div>`
                }
              }
              html += `</div>`
              date.add(1, 'days')
            }
          html += `</div>`
        }
        html += `</div>`
        if (prepend) {
          $(".calendar_set").prepend(html);
        } else {
          $(".calendar_set").append(html);
        }
      }
      var calendar_start = moment();
      var dates_;
      api.getClassDates(function loadDates(dates) {
        dates_ = dates;
        var start_open = moment(dates.open.sort()[0], "YYYYMMDD");
        var end_open = moment(dates.open.sort()[dates.open.length-1], "YYYYMMDD");
        $(".open_date_1").html(start_open.format("MMMM DD"));
        $(".open_date_2").html(end_open.format("MMMM DD"));
        var calendar_date = moment(calendar_start)
        for (let i = 0; i < 3; i++) {
          addCalendar(calendar_date.month(), calendar_date.year(), dates);
          calendar_date.add(1, "months")
        }
      })
      $(".next_calendar").click(function () {
        $(".calendar:first").remove();
        calendar_start.add(1, "months")
        var calendar_date = moment(calendar_start).add(2, "months")
        addCalendar(calendar_date.month(), calendar_date.year(), dates_);
      })
      $(".previous_calendar").click(function () {
        $(".calendar:last").remove();
        calendar_start.subtract(1, "months")
        addCalendar(calendar_start.month(), calendar_start.year(), dates_, true);
      })
    </script>
  </body>
</html>
